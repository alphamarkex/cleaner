<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanStock Pro | Complete Inventory System</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #333333;
            min-height: 100vh;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, #0a9396 0%, #005f73 100%);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 5px;
            margin: 25px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 25px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }
        
        .tab.active {
            background: #ffffff;
            color: #0a9396;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
        }
        
        .tab:hover:not(.active) {
            background: rgba(10, 147, 150, 0.05);
            color: #0a9396;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            border: 1px solid #eaeaea;
        }
        
        h2 {
            color: #2d3e50;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eaeaea;
            font-weight: 600;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.3s;
            background: #ffffff;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0a9396;
            box-shadow: 0 0 0 3px rgba(10, 147, 150, 0.1);
        }
        
        .btn {
            background: #0a9396;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: #087a7d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .btn-success {
            background: #0a9396;
        }
        
        .btn-success:hover {
            background: #087a7d;
        }
        
        .btn-warning {
            background: #0a9396;
        }
        
        .btn-warning:hover {
            background: #087a7d;
        }
        
        .btn-danger {
            background: #0a9396;
        }
        
        .btn-danger:hover {
            background: #087a7d;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            font-size: 0.95rem;
        }
        
        .alert-error {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        
        .alert-success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .alert-info {
            background-color: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .product-card {
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            border: 1px solid #eaeaea;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .product-card h3 {
            color: #2d3e50;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .stock-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }
        
        .stock-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0a9396;
        }
        
        .stock-low {
            color: #dc3545;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .barcode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .barcode-item {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #eaeaea;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px 0;
            margin-top: 50px;
            border-top: 1px solid #eaeaea;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .inventory-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .tab {
                min-width: 100%;
            }
            
            .price-tag-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Scanner Styles */
        .scanner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .scanner-preview {
            width: 100%;
            max-width: 500px;
            height: 400px;
            background: #000;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 10;
        }
        
        .scanner-frame {
            width: 70%;
            height: 40%;
            border: 3px solid #0a9396;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.3);
        }
        
        .scanner-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #0a9396;
            top: 10%;
            animation: scan 2s infinite linear;
        }
        
        @keyframes scan {
            0% { top: 10%; }
            50% { top: 90%; }
            100% { top: 10%; }
        }
        
        .scan-mode-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #0a9396;
            background: white;
            color: #0a9396;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: #0a9396;
            color: white;
        }
        
        /* Scanner Video */
        #scanner-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror the video for better UX */
        }
        
        #scanner-canvas {
            display: none;
        }
        
        .scanner-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .camera-permission {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .camera-permission i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #0a9396;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #0a9396;
        }
        
        .product-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-tag {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #eaeaea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-tag.active {
            background: #0a9396;
            color: white;
            border-color: #0a9396;
        }
        
        .category-tag:hover {
            background: #e9ecef;
        }
        
        .category-tag.active:hover {
            background: #087a7d;
        }
        
        .search-box {
            margin: 20px 0;
        }
        
        .barcode-display {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .product-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eaeaea;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        /* Price Tag Styles */
        .price-tag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .price-tag {
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            page-break-inside: avoid;
        }
        
        .price-tag .product-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3e50;
        }
        
        .price-tag .mrp {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 5px;
        }
        
        .price-tag .expiry {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .price-tag .barcode-container {
            margin: 10px 0;
        }
        
        .price-tag .product-info {
            font-size: 11px;
            color: #495057;
            text-align: left;
            margin-top: 8px;
        }
        
        .price-tag .batch-number {
            font-size: 10px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        /* Dashboard Styles */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaeaea;
            text-align: center;
        }
        
        .stat-card i {
            font-size: 2rem;
            color: #0a9396;
            margin-bottom: 10px;
        }
        
        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2d3e50;
            margin: 10px 0;
        }
        
        .stat-card .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #2d3e50;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* Dispatch Styles */
        .dispatch-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .dispatch-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .dispatch-item:last-child {
            border-bottom: none;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-input {
            width: 50px;
            text-align: center;
            padding: 5px;
        }
        
        /* Price Display Styles */
        .price-tag .mrp {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 5px;
        }
        
        .product-card .price {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
        }
        
        .scanned-product-price {
            font-weight: bold;
            color: #28a745;
        }
        
        .transaction-history {
            margin-top: 30px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .transaction-type {
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .transaction-checkin {
            background: #d4edda;
            color: #155724;
        }
        
        .transaction-checkout {
            background: #f8d7da;
            color: #721c24;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .price-tag, .price-tag * {
                visibility: visible;
            }
            .price-tag {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: 1px solid #000;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Database Controls */
        .database-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #0a9396;
        }

        .backup-section {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #0a9396;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #eaeaea;
        }

        .backup-status i {
            color: #0a9396;
        }

        .monthly-backup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .backup-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eaeaea;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .backup-card h4 {
            color: #2d3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .backup-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        /* Scanner instructions */
        .scanner-instructions {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #0a9396;
        }

        .scanner-instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .scanner-instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-pump-soap"></i>
                    <div>
                        <h1>CleanStock Pro</h1>
                        <p style="font-size: 0.9rem; opacity: 0.8;">Complete Inventory Management System</p>
                    </div>
                </div>
                <div style="font-size: 0.9rem; opacity: 0.9;">
                    <i class="fas fa-database"></i> Data Persistence: <span id="dbStatus">Active</span>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Database Controls -->
            <div class="database-controls">
                <h3><i class="fas fa-database"></i> Database Management</h3>
                <p>All your data is automatically saved and will persist between browser sessions.</p>
                <div class="action-buttons">
                    <button class="btn" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="btn" onclick="importData()">
                        <i class="fas fa-upload"></i> Import Data
                    </button>
                    <button class="btn" onclick="clearAllData()">
                        <i class="fas fa-trash"></i> Clear All Data
                    </button>
                    <button class="btn" onclick="addSampleData()">
                        <i class="fas fa-vial"></i> Add Sample Data
                    </button>
                </div>
                <div id="dbInfo" style="margin-top: 10px; font-size: 0.9rem; color: #6c757d;"></div>
            </div>

            <!-- Monthly Backup Section -->
            <div class="backup-section">
                <h3><i class="fas fa-history"></i> Monthly Data Backup</h3>
                <p>Automatically create and manage monthly backups of your inventory data.</p>
                
                <div class="backup-status">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Last Backup:</strong> 
                        <span id="lastBackupDate">Never</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="createMonthlyBackup()">
                        <i class="fas fa-plus"></i> Create Monthly Backup
                    </button>
                    <button class="btn" onclick="enableAutoBackup()">
                        <i class="fas fa-robot"></i> Enable Auto Backup
                    </button>
                    <button class="btn" onclick="disableAutoBackup()">
                        <i class="fas fa-stop"></i> Disable Auto Backup
                    </button>
                </div>

                <div id="monthlyBackups" class="monthly-backup-grid" style="margin-top: 20px;">
                    <!-- Backup cards will be populated here -->
                </div>
            </div>

            <div class="nav-tabs">
                <button class="tab active" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="tab" data-tab="product-setup">
                    <i class="fas fa-plus-circle"></i> Add Product
                </button>
                <button class="tab" data-tab="price-tags">
                    <i class="fas fa-tags"></i> Price Tags
                </button>
                <button class="tab" data-tab="scan">
                    <i class="fas fa-camera"></i> Scan & Dispatch
                </button>
                <button class="tab" data-tab="inventory">
                    <i class="fas fa-boxes"></i> Inventory
                </button>
            </div>
            
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard-tab">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <i class="fas fa-boxes"></i>
                        <div class="stat-value" id="totalProducts">0</div>
                        <div class="stat-label">Total Products</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-barcode"></i>
                        <div class="stat-value" id="totalBarcodes">0</div>
                        <div class="stat-label">Barcodes Generated</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-shopping-cart"></i>
                        <div class="stat-value" id="totalStock">0</div>
                        <div class="stat-label">Total Stock Items</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="stat-value" id="lowStockItems">0</div>
                        <div class="stat-label">Low Stock Items</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-truck"></i>
                        <div class="stat-value" id="dispatchedToday">0</div>
                        <div class="stat-label">Dispatched Today</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-tags"></i>
                        <div class="stat-value" id="priceTagsGenerated">0</div>
                        <div class="stat-label">Price Tags Generated</div>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-star"></i> Quick Actions</h2>
                    <div class="action-buttons">
                        <button class="btn" onclick="showTab('product-setup')">
                            <i class="fas fa-plus-circle"></i> Add New Product
                        </button>
                        <button class="btn" onclick="showTab('price-tags')">
                            <i class="fas fa-tags"></i> Generate Price Tags
                        </button>
                        <button class="btn" onclick="showTab('scan')">
                            <i class="fas fa-camera"></i> Scan & Dispatch
                        </button>
                        <button class="btn" onclick="showTab('inventory')">
                            <i class="fas fa-boxes"></i> View Inventory
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-history"></i> Recent Transactions</h2>
                    <div id="recentTransactions">
                        <p>No recent transactions</p>
                    </div>
                </div>
            </div>
            
            <!-- Product Setup Tab -->
            <div class="tab-content" id="product-setup-tab">
                <div class="card">
                    <h2><i class="fas fa-pump-soap"></i> Add New Product</h2>
                    
                    <div class="form-group">
                        <label for="productName">Product Name *</label>
                        <input type="text" id="productName" placeholder="Enter product name">
                    </div>
                    
                    <div class="info-grid">
                        <div class="form-group">
                            <label for="productPrice">MRP (â‚¹) *</label>
                            <input type="number" id="productPrice" min="0" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="productCategory">Category *</label>
                            <select id="productCategory">
                                <option value="Detergent">Detergent</option>
                                <option value="Toilet Cleaner">Toilet Cleaner</option>
                                <option value="Floor Cleaner">Floor Cleaner</option>
                                <option value="Glass Cleaner">Glass Cleaner</option>
                                <option value="Disinfectant">Disinfectant</option>
                                <option value="Bleach">Bleach</option>
                                <option value="Dish Soap">Dish Soap</option>
                                <option value="Multi-purpose Cleaner">Multi-purpose Cleaner</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="form-group">
                            <label for="manufacturingDate">Manufacturing Date</label>
                            <input type="date" id="manufacturingDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date *</label>
                            <input type="date" id="expiryDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="manufacturer">Manufacturer *</label>
                        <input type="text" id="manufacturer" placeholder="Manufacturer name">
                    </div>
                    
                    <div class="info-grid">
                        <div class="form-group">
                            <label for="batchNumber">Batch Number *</label>
                            <input type="text" id="batchNumber" placeholder="Batch number">
                        </div>
                        
                        <div class="form-group">
                            <label for="productSize">Size/Volume *</label>
                            <input type="text" id="productSize" placeholder="e.g., 1L, 500ml, 2kg">
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="form-group">
                            <label for="initialStock">Initial Stock Quantity *</label>
                            <input type="number" id="initialStock" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="lowStockThreshold">Low Stock Alert</label>
                            <input type="number" id="lowStockThreshold" min="1" value="5" placeholder="Alert when stock below">
                        </div>
                    </div>
                    
                    <button id="saveProductBtn" class="btn"><i class="fas fa-save"></i> Save Product & Generate Barcode</button>
                    
                    <div class="alert alert-error" id="errorMessage" style="display: none;">
                        <strong>Error:</strong> <span id="errorText"></span>
                    </div>
                    
                    <div class="alert alert-success" id="successMessage" style="display: none;">
                        <strong>Success!</strong> <span id="successText"></span>
                    </div>
                </div>
            </div>
            
            <!-- Price Tags Tab -->
            <div class="tab-content" id="price-tags-tab">
                <div class="card">
                    <h2><i class="fas fa-tags"></i> Generate Price Tags</h2>
                    
                    <div class="form-group">
                        <label for="priceTagProduct">Select Product</label>
                        <select id="priceTagProduct">
                            <option value="">Select a product</option>
                        </select>
                    </div>
                    
                    <div class="info-grid">
                        <div class="form-group">
                            <label for="priceTagQuantity">Number of Tags</label>
                            <input type="number" id="priceTagQuantity" min="1" max="50" value="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="tagSize">Tag Size</label>
                            <select id="tagSize">
                                <option value="small">Small (2x1 inch)</option>
                                <option value="medium" selected>Medium (3x2 inch)</option>
                                <option value="large">Large (4x3 inch)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button id="generatePriceTagsBtn" class="btn"><i class="fas fa-tags"></i> Generate Price Tags</button>
                    <button id="printAllTagsBtn" class="btn" style="display: none;"><i class="fas fa-print"></i> Print All Tags</button>
                    
                    <div id="priceTagsContainer" class="price-tag-grid" style="display: none; margin-top: 20px;">
                        <!-- Price tags will be generated here -->
                    </div>
                </div>
            </div>
            
            <!-- Scan & Dispatch Tab -->
            <div class="tab-content" id="scan-tab">
                <div class="card">
                    <h2><i class="fas fa-camera"></i> Scan & Dispatch Products</h2>
                    
                    <div class="scanner-instructions">
                        <h4><i class="fas fa-info-circle"></i> Scanner Instructions</h4>
                        <ul>
                            <li>Click "Start Scanner" to activate your camera</li>
                            <li>Allow camera permissions when prompted</li>
                            <li>Point the camera at a barcode to scan</li>
                            <li>Ensure good lighting for better scanning</li>
                            <li>Hold the barcode within the scanner frame</li>
                        </ul>
                    </div>
                    
                    <div class="scan-mode-selector">
                        <button class="mode-btn active" data-mode="scan">Scan Product</button>
                        <button class="mode-btn" data-mode="dispatch">Dispatch Products</button>
                    </div>
                    
                    <!-- Scan Mode -->
                    <div id="scanMode" class="scanner-container">
                        <div class="scanner-preview" id="scanner-preview">
                            <div id="cameraPermission" class="camera-permission" style="display: flex;">
                                <div>
                                    <i class="fas fa-camera"></i>
                                    <h3>Camera Access Required</h3>
                                    <p>Click "Start Scanner" to begin scanning barcodes</p>
                                </div>
                            </div>
                            <video id="scanner-video" autoplay playsinline></video>
                            <canvas id="scanner-canvas"></canvas>
                            <div class="scanner-overlay">
                                <div class="scanner-frame">
                                    <div class="scanner-line"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="scanner-controls">
                            <button id="startScannerBtn" class="btn">
                                <i class="fas fa-play"></i> Start Scanner
                            </button>
                            <button id="stopScannerBtn" class="btn" style="display: none;">
                                <i class="fas fa-stop"></i> Stop Scanner
                            </button>
                            <button id="switchCameraBtn" class="btn" style="display: none;">
                                <i class="fas fa-sync"></i> Switch Camera
                            </button>
                        </div>
                        
                        <div class="scan-result">
                            <h3>Scan Result:</h3>
                            <div id="scanResultText">No barcode scanned yet</div>
                            
                            <div id="scannedProductInfo" class="product-details" style="display: none;">
                                <h4>Product Information</h4>
                                <div class="detail-row">
                                    <span>Product Name:</span>
                                    <span id="scannedProductName"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Category:</span>
                                    <span id="scannedProductCategory"></span>
                                </div>
                                <div class="detail-row">
                                    <span>MRP:</span>
                                    <span id="scannedProductPrice" class="scanned-product-price"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Manufacturer:</span>
                                    <span id="scannedProductManufacturer"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Batch Number:</span>
                                    <span id="scannedProductBatch"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Expiry Date:</span>
                                    <span id="scannedProductExpiry"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Current Stock:</span>
                                    <span id="scannedProductStock"></span>
                                </div>
                                <div class="detail-row">
                                    <span>Size:</span>
                                    <span id="scannedProductSize"></span>
                                </div>
                                
                                <div class="action-buttons" style="margin-top: 15px;">
                                    <button class="btn" onclick="addToDispatch()">
                                        <i class="fas fa-truck"></i> Add to Dispatch
                                    </button>
                                    <button class="btn" onclick="showEditProductModal()">
                                        <i class="fas fa-edit"></i> Edit Product
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dispatch Mode -->
                    <div id="dispatchMode" class="dispatch-container" style="display: none;">
                        <h3>Dispatch Products</h3>
                        <div id="dispatchItems">
                            <p>No items added for dispatch</p>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button class="btn" onclick="confirmDispatch()">
                                <i class="fas fa-check"></i> Confirm Dispatch
                            </button>
                            <button class="btn" onclick="clearDispatch()">
                                <i class="fas fa-trash"></i> Clear All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Inventory Tab -->
            <div class="tab-content" id="inventory-tab">
                <div class="card">
                    <h2><i class="fas fa-boxes"></i> Product Inventory</h2>
                    
                    <div id="inventoryContainer">
                        <div id="emptyInventory" class="empty-state" style="display: none;">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Yet</h3>
                            <p>You haven't added any products to your inventory yet.</p>
                            <button class="btn" onclick="showTab('product-setup')" style="margin-top: 15px;">
                                <i class="fas fa-plus-circle"></i> Add Your First Product
                            </button>
                        </div>
                        <div id="inventoryGrid" class="inventory-grid">
                            <!-- Inventory items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="container">
                <p>CleanStock Pro &copy; 2023 | Complete Inventory Management System | Data Persistence: <span id="footerDbStatus">Active</span></p>
            </div>
        </footer>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal" id="editProductModal">
        <div class="modal-content">
            <h3><i class="fas fa-edit"></i> Edit Product</h3>
            <div id="editProductForm">
                <!-- Edit form will be populated here -->
            </div>
            <div class="modal-buttons">
                <button class="btn" onclick="closeEditModal()">Cancel</button>
                <button class="btn" onclick="updateProduct()">Update Product</button>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFile" style="display: none;" accept=".json">

    <script>
        // Real Camera Scanner Implementation
        class CameraScanner {
            constructor() {
                this.stream = null;
                this.isScanning = false;
                this.currentFacingMode = 'environment'; // Prefer rear camera
                this.videoElement = document.getElementById('scanner-video');
                this.canvasElement = document.getElementById('scanner-canvas');
                this.canvasContext = this.canvasElement.getContext('2d');
                this.barcodeDetector = null;
                
                // Initialize BarcodeDetector if available
                if ('BarcodeDetector' in window) {
                    this.barcodeDetector = new BarcodeDetector({
                        formats: ['code_128', 'ean_13', 'ean_8', 'upc_a', 'upc_e', 'qr_code']
                    });
                }
                
                this.initEventListeners();
            }
            
            initEventListeners() {
                document.getElementById('startScannerBtn').addEventListener('click', () => this.startScanner());
                document.getElementById('stopScannerBtn').addEventListener('click', () => this.stopScanner());
                document.getElementById('switchCameraBtn').addEventListener('click', () => this.switchCamera());
            }
            
            async startScanner() {
                try {
                    // Request camera permissions
                    this.stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: this.currentFacingMode,
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false
                    });
                    
                    // Show video stream
                    this.videoElement.srcObject = this.stream;
                    document.getElementById('cameraPermission').style.display = 'none';
                    this.videoElement.style.display = 'block';
                    
                    // Update UI
                    document.getElementById('startScannerBtn').style.display = 'none';
                    document.getElementById('stopScannerBtn').style.display = 'inline-flex';
                    document.getElementById('switchCameraBtn').style.display = 'inline-flex';
                    
                    // Wait for video to be ready
                    this.videoElement.onloadedmetadata = () => {
                        this.videoElement.play();
                        this.startScanning();
                    };
                    
                    document.getElementById('scanResultText').textContent = 'Scanner active - point camera at barcode';
                    
                } catch (error) {
                    console.error('Error accessing camera:', error);
                    this.handleCameraError(error);
                }
            }
            
            handleCameraError(error) {
                let errorMessage = 'Unable to access camera. ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Please allow camera permissions and try again.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'No camera found on this device.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += 'Camera not supported on this device.';
                } else {
                    errorMessage += `Error: ${error.message}`;
                }
                
                document.getElementById('scanResultText').textContent = errorMessage;
                showError(errorMessage);
            }
            
            async startScanning() {
                this.isScanning = true;
                
                const scanFrame = async () => {
                    if (!this.isScanning) return;
                    
                    try {
                        // Draw video frame to canvas
                        this.canvasElement.width = this.videoElement.videoWidth;
                        this.canvasElement.height = this.videoElement.videoHeight;
                        this.canvasContext.drawImage(this.videoElement, 0, 0);
                        
                        // Try to detect barcodes
                        if (this.barcodeDetector) {
                            const barcodes = await this.barcodeDetector.detect(this.canvasElement);
                            
                            if (barcodes.length > 0) {
                                const barcode = barcodes[0];
                                this.handleBarcodeDetected(barcode.rawValue);
                                return; // Stop scanning after successful detection
                            }
                        }
                        
                        // Fallback: Use Quagga if BarcodeDetector is not available or didn't detect anything
                        await this.tryQuaggaDetection();
                        
                    } catch (error) {
                        console.error('Scanning error:', error);
                    }
                    
                    // Continue scanning
                    if (this.isScanning) {
                        requestAnimationFrame(scanFrame);
                    }
                };
                
                // Start the scanning loop
                scanFrame();
            }
            
            async tryQuaggaDetection() {
                return new Promise((resolve) => {
                    try {
                        Quagga.decodeSingle({
                            decoder: {
                                readers: ['code_128_reader', 'ean_reader', 'ean_8_reader', 'upc_reader', 'upc_e_reader']
                            },
                            locate: true,
                            src: this.canvasElement.toDataURL(),
                            numOfWorkers: 0, // No web workers for simplicity
                        }, (result) => {
                            if (result && result.codeResult) {
                                this.handleBarcodeDetected(result.codeResult.code);
                            }
                            resolve();
                        });
                    } catch (error) {
                        console.error('Quagga detection error:', error);
                        resolve();
                    }
                });
            }
            
            handleBarcodeDetected(barcodeValue) {
                console.log('Barcode detected:', barcodeValue);
                document.getElementById('scanResultText').textContent = `Scanned: ${barcodeValue}`;
                
                // Find product by barcode
                const product = db.getProductByBarcode(barcodeValue);
                if (product) {
                    displayProductInfo(product);
                    showSuccess(`Product "${product.productName}" found!`);
                } else {
                    showError(`No product found with barcode: ${barcodeValue}`);
                    document.getElementById('scannedProductInfo').style.display = 'none';
                }
                
                // Optional: Stop scanning after successful detection
                // this.stopScanner();
            }
            
            stopScanner() {
                this.isScanning = false;
                
                // Stop video stream
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                // Reset UI
                this.videoElement.srcObject = null;
                this.videoElement.style.display = 'none';
                document.getElementById('cameraPermission').style.display = 'flex';
                document.getElementById('startScannerBtn').style.display = 'inline-flex';
                document.getElementById('stopScannerBtn').style.display = 'none';
                document.getElementById('switchCameraBtn').style.display = 'none';
                
                document.getElementById('scanResultText').textContent = 'Scanner stopped';
            }
            
            async switchCamera() {
                this.stopScanner();
                
                // Toggle between front and back camera
                this.currentFacingMode = this.currentFacingMode === 'environment' ? 'user' : 'environment';
                
                // Restart scanner with new camera
                setTimeout(() => this.startScanner(), 500);
            }
        }

        // Initialize camera scanner
        const cameraScanner = new CameraScanner();

        // Complete Barcode Database System with Persistent Storage and Monthly Backup
        class BarcodeDatabase {
            constructor() {
                this.init();
            }
            
            init() {
                // Initialize databases if they don't exist
                if (!localStorage.getItem('products')) {
                    localStorage.setItem('products', JSON.stringify([]));
                }
                if (!localStorage.getItem('transactions')) {
                    localStorage.setItem('transactions', JSON.stringify([]));
                }
                if (!localStorage.getItem('dispatchItems')) {
                    localStorage.setItem('dispatchItems', JSON.stringify([]));
                }
                if (!localStorage.getItem('priceTagsGenerated')) {
                    localStorage.setItem('priceTagsGenerated', '0');
                }
                if (!localStorage.getItem('monthlyBackups')) {
                    localStorage.setItem('monthlyBackups', JSON.stringify([]));
                }
                if (!localStorage.getItem('autoBackupEnabled')) {
                    localStorage.setItem('autoBackupEnabled', 'false');
                }
                if (!localStorage.getItem('lastBackupDate')) {
                    localStorage.setItem('lastBackupDate', '');
                }
                
                this.loadProducts();
                this.updateDashboard();
                this.populateProductDropdown();
                this.renderInventory();
                this.updateDatabaseInfo();
                this.renderMonthlyBackups();
                this.checkAutoBackup();
            }
            
            loadProducts() {
                this.products = JSON.parse(localStorage.getItem('products')) || [];
            }
            
            saveProducts() {
                localStorage.setItem('products', JSON.stringify(this.products));
                this.updateDatabaseInfo();
            }
            
            addProduct(productData) {
                // Generate unique ID and barcode
                const id = this.generateId();
                const barcode = this.generateBarcode(id);
                
                const product = {
                    id,
                    barcode,
                    ...productData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.products.push(product);
                this.saveProducts();
                
                // Add transaction record
                this.addTransaction('checkin', product, productData.initialStock);
                
                return product;
            }
            
            updateProduct(id, updatedData) {
                const index = this.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.products[index] = {
                        ...this.products[index],
                        ...updatedData,
                        updatedAt: new Date().toISOString()
                    };
                    this.saveProducts();
                    return true;
                }
                return false;
            }
            
            deleteProduct(id) {
                const index = this.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.products.splice(index, 1);
                    this.saveProducts();
                    return true;
                }
                return false;
            }
            
            getProductByBarcode(barcode) {
                return this.products.find(p => p.barcode === barcode);
            }
            
            getProductById(id) {
                return this.products.find(p => p.id === id);
            }
            
            generateId() {
                return 'PROD_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            generateBarcode(id) {
                // Simple barcode generation using product ID
                return 'CS' + id.replace(/[^0-9]/g, '').substr(0, 10).padStart(10, '0');
            }
            
            addTransaction(type, product, quantity, notes = '') {
                const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
                
                transactions.push({
                    id: 'TXN_' + Date.now(),
                    type,
                    productId: product.id,
                    productName: product.productName,
                    quantity,
                    timestamp: new Date().toISOString(),
                    notes
                });
                
                localStorage.setItem('transactions', JSON.stringify(transactions));
                this.updateDatabaseInfo();
            }
            
            getRecentTransactions(limit = 5) {
                const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
                return transactions
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .slice(0, limit);
            }
            
            updateStock(productId, quantityChange) {
                const product = this.getProductById(productId);
                if (product) {
                    const newStock = Math.max(0, product.currentStock + quantityChange);
                    this.updateProduct(productId, { currentStock: newStock });
                    return newStock;
                }
                return null;
            }
            
            addToDispatch(productId, quantity) {
                let dispatchItems = JSON.parse(localStorage.getItem('dispatchItems')) || [];
                
                const existingItem = dispatchItems.find(item => item.productId === productId);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    const product = this.getProductById(productId);
                    if (product) {
                        dispatchItems.push({
                            productId,
                            productName: product.productName,
                            quantity,
                            price: product.productPrice
                        });
                    }
                }
                
                localStorage.setItem('dispatchItems', JSON.stringify(dispatchItems));
                this.updateDatabaseInfo();
            }
            
            getDispatchItems() {
                return JSON.parse(localStorage.getItem('dispatchItems')) || [];
            }
            
            clearDispatch() {
                localStorage.setItem('dispatchItems', JSON.stringify([]));
                this.updateDatabaseInfo();
            }
            
            confirmDispatch() {
                const dispatchItems = this.getDispatchItems();
                let totalDispatched = 0;
                
                dispatchItems.forEach(item => {
                    const newStock = this.updateStock(item.productId, -item.quantity);
                    if (newStock !== null) {
                        totalDispatched += item.quantity;
                        this.addTransaction('checkout', 
                            this.getProductById(item.productId), 
                            item.quantity, 
                            'Dispatched from system'
                        );
                    }
                });
                
                this.clearDispatch();
                return totalDispatched;
            }
            
            updateDashboard() {
                // Update dashboard statistics
                document.getElementById('totalProducts').textContent = this.products.length;
                document.getElementById('totalBarcodes').textContent = this.products.length;
                
                const totalStock = this.products.reduce((sum, product) => sum + product.currentStock, 0);
                document.getElementById('totalStock').textContent = totalStock;
                
                const lowStockItems = this.products.filter(
                    product => product.currentStock <= product.lowStockThreshold
                ).length;
                document.getElementById('lowStockItems').textContent = lowStockItems;
                
                // Calculate dispatched today
                const today = new Date().toISOString().split('T')[0];
                const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
                const dispatchedToday = transactions
                    .filter(t => t.type === 'checkout' && t.timestamp.startsWith(today))
                    .reduce((sum, t) => sum + t.quantity, 0);
                document.getElementById('dispatchedToday').textContent = dispatchedToday;
                
                document.getElementById('priceTagsGenerated').textContent = 
                    localStorage.getItem('priceTagsGenerated') || '0';
                
                // Update recent transactions
                this.renderRecentTransactions();
            }
            
            renderRecentTransactions() {
                const container = document.getElementById('recentTransactions');
                const transactions = this.getRecentTransactions(5);
                
                if (transactions.length === 0) {
                    container.innerHTML = '<p>No recent transactions</p>';
                    return;
                }
                
                let html = '';
                transactions.forEach(transaction => {
                    const date = new Date(transaction.timestamp).toLocaleDateString();
                    const time = new Date(transaction.timestamp).toLocaleTimeString();
                    
                    html += `
                        <div class="transaction-item">
                            <div>
                                <strong>${transaction.productName}</strong>
                                <div style="font-size: 0.8rem; color: #6c757d;">${date} ${time}</div>
                            </div>
                            <div style="text-align: right;">
                                <span class="transaction-type ${transaction.type === 'checkin' ? 'transaction-checkin' : 'transaction-checkout'}">
                                    ${transaction.type === 'checkin' ? 'IN' : 'OUT'}
                                </span>
                                <div style="font-weight: bold; margin-top: 5px;">${transaction.quantity} units</div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            populateProductDropdown() {
                const dropdown = document.getElementById('priceTagProduct');
                dropdown.innerHTML = '<option value="">Select a product</option>';
                
                this.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = `${product.productName} (${product.barcode})`;
                    dropdown.appendChild(option);
                });
            }
            
            renderInventory() {
                const container = document.getElementById('inventoryGrid');
                const emptyState = document.getElementById('emptyInventory');
                
                if (this.products.length === 0) {
                    container.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                let html = '';
                this.products.forEach(product => {
                    const isLowStock = product.currentStock <= product.lowStockThreshold;
                    
                    html += `
                        <div class="product-card">
                            <h3>${product.productName}</h3>
                            <div class="detail-row">
                                <span>Category:</span>
                                <span>${product.productCategory}</span>
                            </div>
                            <div class="detail-row">
                                <span>MRP:</span>
                                <span class="price">â‚¹${product.productPrice}</span>
                            </div>
                            <div class="detail-row">
                                <span>Manufacturer:</span>
                                <span>${product.manufacturer}</span>
                            </div>
                            <div class="detail-row">
                                <span>Batch:</span>
                                <span>${product.batchNumber}</span>
                            </div>
                            <div class="detail-row">
                                <span>Size:</span>
                                <span>${product.productSize}</span>
                            </div>
                            <div class="stock-info">
                                <div>
                                    <div>Current Stock</div>
                                    <div class="stock-count ${isLowStock ? 'stock-low' : ''}">
                                        ${product.currentStock}
                                    </div>
                                </div>
                                <div>
                                    <div>Barcode</div>
                                    <div style="font-family: monospace; font-size: 0.9rem;">${product.barcode}</div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn" onclick="generateSinglePriceTag('${product.id}')">
                                    <i class="fas fa-tag"></i> Price Tag
                                </button>
                                <button class="btn" onclick="editProduct('${product.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn" onclick="deleteProduct('${product.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            incrementPriceTagsGenerated() {
                const current = parseInt(localStorage.getItem('priceTagsGenerated') || '0');
                localStorage.setItem('priceTagsGenerated', (current + 1).toString());
                this.updateDashboard();
                this.updateDatabaseInfo();
            }
            
            updateDatabaseInfo() {
                const products = JSON.parse(localStorage.getItem('products') || '[]');
                const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
                const dispatchItems = JSON.parse(localStorage.getItem('dispatchItems') || '[]');
                
                const info = `Products: ${products.length} | Transactions: ${transactions.length} | Pending Dispatch: ${dispatchItems.length}`;
                document.getElementById('dbInfo').textContent = info;
            }
            
            // Database management methods
            exportData() {
                const data = {
                    products: JSON.parse(localStorage.getItem('products') || '[]'),
                    transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
                    priceTagsGenerated: localStorage.getItem('priceTagsGenerated') || '0',
                    exportDate: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `cleanstock-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showSuccess('Data exported successfully!');
            }
            
            importData() {
                document.getElementById('importFile').click();
            }
            
            handleImport(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.products) {
                            localStorage.setItem('products', JSON.stringify(data.products));
                        }
                        if (data.transactions) {
                            localStorage.setItem('transactions', JSON.stringify(data.transactions));
                        }
                        if (data.priceTagsGenerated) {
                            localStorage.setItem('priceTagsGenerated', data.priceTagsGenerated);
                        }
                        
                        // Reload the application
                        this.init();
                        showSuccess('Data imported successfully!');
                    } catch (error) {
                        showError('Invalid data file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
            
            clearAllData() {
                if (confirm('Are you sure you want to clear ALL data? This action cannot be undone!')) {
                    localStorage.removeItem('products');
                    localStorage.removeItem('transactions');
                    localStorage.removeItem('dispatchItems');
                    localStorage.removeItem('priceTagsGenerated');
                    localStorage.removeItem('monthlyBackups');
                    localStorage.removeItem('autoBackupEnabled');
                    localStorage.removeItem('lastBackupDate');
                    
                    // Reload the application
                    this.init();
                    showSuccess('All data cleared successfully!');
                }
            }
            
            addSampleData() {
                const sampleProducts = [
                    {
                        productName: "Ultra Clean Detergent",
                        productPrice: 299.99,
                        productCategory: "Detergent",
                        manufacturingDate: "2023-01-15",
                        expiryDate: "2024-01-15",
                        manufacturer: "CleanCo Industries",
                        batchNumber: "BATCH001",
                        productSize: "2kg",
                        initialStock: 50,
                        currentStock: 50,
                        lowStockThreshold: 5
                    },
                    {
                        productName: "Fresh Scent Toilet Cleaner",
                        productPrice: 149.50,
                        productCategory: "Toilet Cleaner",
                        manufacturingDate: "2023-02-20",
                        expiryDate: "2024-02-20",
                        manufacturer: "Hygiene Solutions",
                        batchNumber: "BATCH002",
                        productSize: "750ml",
                        initialStock: 30,
                        currentStock: 30,
                        lowStockThreshold: 3
                    },
                    {
                        productName: "Sparkle Glass Cleaner",
                        productPrice: 89.99,
                        productCategory: "Glass Cleaner",
                        manufacturingDate: "2023-03-10",
                        expiryDate: "2024-03-10",
                        manufacturer: "ClearView Products",
                        batchNumber: "BATCH003",
                        productSize: "500ml",
                        initialStock: 25,
                        currentStock: 25,
                        lowStockThreshold: 2
                    }
                ];
                
                sampleProducts.forEach(productData => {
                    this.addProduct(productData);
                });
                
                showSuccess('Sample data added successfully!');
            }
            
            // Monthly Backup Methods
            createMonthlyBackup() {
                const now = new Date();
                const monthYear = now.toLocaleString('default', { month: 'long', year: 'numeric' });
                const backupId = 'BACKUP_' + now.getTime();
                
                const backupData = {
                    id: backupId,
                    name: `Backup - ${monthYear}`,
                    timestamp: now.toISOString(),
                    data: {
                        products: JSON.parse(localStorage.getItem('products') || '[]'),
                        transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
                        priceTagsGenerated: localStorage.getItem('priceTagsGenerated') || '0'
                    },
                    size: this.calculateDataSize()
                };
                
                const backups = JSON.parse(localStorage.getItem('monthlyBackups') || '[]');
                backups.push(backupData);
                localStorage.setItem('monthlyBackups', JSON.stringify(backups));
                localStorage.setItem('lastBackupDate', now.toISOString());
                
                this.renderMonthlyBackups();
                showSuccess(`Monthly backup created for ${monthYear}`);
            }
            
            calculateDataSize() {
                const products = localStorage.getItem('products') || '[]';
                const transactions = localStorage.getItem('transactions') || '[]';
                const totalSize = (products.length + transactions.length) / 1024; // Convert to KB
                return totalSize.toFixed(2) + ' KB';
            }
            
            renderMonthlyBackups() {
                const container = document.getElementById('monthlyBackups');
                const backups = JSON.parse(localStorage.getItem('monthlyBackups') || '[]');
                const lastBackupDate = localStorage.getItem('lastBackupDate');
                
                // Update last backup date
                if (lastBackupDate) {
                    const date = new Date(lastBackupDate);
                    document.getElementById('lastBackupDate').textContent = date.toLocaleString();
                } else {
                    document.getElementById('lastBackupDate').textContent = 'Never';
                }
                
                if (backups.length === 0) {
                    container.innerHTML = '<p>No monthly backups created yet.</p>';
                    return;
                }
                
                // Sort backups by timestamp (newest first)
                backups.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                let html = '';
                backups.forEach(backup => {
                    const date = new Date(backup.timestamp);
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    
                    html += `
                        <div class="backup-card">
                            <h4><i class="fas fa-database"></i> ${backup.name}</h4>
                            <div style="font-size: 0.9rem; color: #6c757d;">
                                <div>Created: ${formattedDate}</div>
                                <div>Size: ${backup.size}</div>
                                <div>Products: ${backup.data.products.length}</div>
                                <div>Transactions: ${backup.data.transactions.length}</div>
                            </div>
                            <div class="backup-actions">
                                <button class="btn btn-small" onclick="restoreBackup('${backup.id}')">
                                    <i class="fas fa-undo"></i> Restore
                                </button>
                                <button class="btn btn-small" onclick="downloadBackup('${backup.id}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                                <button class="btn btn-small" onclick="deleteBackup('${backup.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            restoreBackup(backupId) {
                const backups = JSON.parse(localStorage.getItem('monthlyBackups') || '[]');
                const backup = backups.find(b => b.id === backupId);
                
                if (backup && confirm('Are you sure you want to restore this backup? Current data will be replaced.')) {
                    localStorage.setItem('products', JSON.stringify(backup.data.products));
                    localStorage.setItem('transactions', JSON.stringify(backup.data.transactions));
                    localStorage.setItem('priceTagsGenerated', backup.data.priceTagsGenerated);
                    
                    // Reload the application
                    this.init();
                    showSuccess('Backup restored successfully!');
                }
            }
            
            downloadBackup(backupId) {
                const backups = JSON.parse(localStorage.getItem('monthlyBackups') || '[]');
                const backup = backups.find(b => b.id === backupId);
                
                if (backup) {
                    const dataStr = JSON.stringify(backup, null, 2);
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(dataBlob);
                    link.download = `cleanstock-backup-${backup.name.replace(' ', '-')}.json`;
                    link.click();
                    
                    showSuccess('Backup downloaded successfully!');
                }
            }
            
            deleteBackup(backupId) {
                if (confirm('Are you sure you want to delete this backup?')) {
                    let backups = JSON.parse(localStorage.getItem('monthlyBackups') || '[]');
                    backups = backups.filter(b => b.id !== backupId);
                    localStorage.setItem('monthlyBackups', JSON.stringify(backups));
                    
                    this.renderMonthlyBackups();
                    showSuccess('Backup deleted successfully!');
                }
            }
            
            enableAutoBackup() {
                localStorage.setItem('autoBackupEnabled', 'true');
                showSuccess('Auto backup enabled! Backups will be created automatically.');
                this.checkAutoBackup();
            }
            
            disableAutoBackup() {
                localStorage.setItem('autoBackupEnabled', 'false');
                showSuccess('Auto backup disabled!');
            }
            
            checkAutoBackup() {
                const autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';
                const lastBackupDate = localStorage.getItem('lastBackupDate');
                const now = new Date();
                
                if (autoBackupEnabled) {
                    // Check if we need to create a new monthly backup
                    if (!lastBackupDate) {
                        // First time - create backup
                        this.createMonthlyBackup();
                    } else {
                        const lastBackup = new Date(lastBackupDate);
                        const monthsDiff = (now.getFullYear() - lastBackup.getFullYear()) * 12 + (now.getMonth() - lastBackup.getMonth());
                        
                        if (monthsDiff >= 1) {
                            // It's been a month or more, create new backup
                            this.createMonthlyBackup();
                        }
                    }
                }
            }
        }

        // Initialize the database
        const db = new BarcodeDatabase();

        // Set up file import handler
        document.getElementById('importFile').addEventListener('change', function(e) {
            if (this.files.length > 0) {
                db.handleImport(this.files[0]);
                this.value = ''; // Reset file input
            }
        });

        // Tab navigation
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Update active tab button
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Refresh data if needed
            if (tabName === 'inventory') {
                db.renderInventory();
            } else if (tabName === 'price-tags') {
                db.populateProductDropdown();
            } else if (tabName === 'scan') {
                updateDispatchView();
            }
        }

        // Product form handling
        document.getElementById('saveProductBtn').addEventListener('click', function() {
            const productName = document.getElementById('productName').value;
            const productPrice = document.getElementById('productPrice').value;
            const productCategory = document.getElementById('productCategory').value;
            const manufacturingDate = document.getElementById('manufacturingDate').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const manufacturer = document.getElementById('manufacturer').value;
            const batchNumber = document.getElementById('batchNumber').value;
            const productSize = document.getElementById('productSize').value;
            const initialStock = parseInt(document.getElementById('initialStock').value);
            const lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value);
            
            // Validation
            if (!productName || !productPrice || !productCategory || !expiryDate || 
                !manufacturer || !batchNumber || !productSize || isNaN(initialStock)) {
                showError('Please fill in all required fields');
                return;
            }
            
            if (initialStock < 0) {
                showError('Initial stock cannot be negative');
                return;
            }
            
            // Create product
            const productData = {
                productName,
                productPrice: parseFloat(productPrice),
                productCategory,
                manufacturingDate,
                expiryDate,
                manufacturer,
                batchNumber,
                productSize,
                initialStock,
                currentStock: initialStock,
                lowStockThreshold
            };
            
            const product = db.addProduct(productData);
            
            // Show success message
            showSuccess(`Product "${product.productName}" added successfully with barcode: ${product.barcode}`);
            
            // Reset form
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('manufacturingDate').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('manufacturer').value = '';
            document.getElementById('batchNumber').value = '';
            document.getElementById('productSize').value = '';
            document.getElementById('initialStock').value = '0';
            
            // Update dashboard and inventory
            db.updateDashboard();
            db.renderInventory();
            db.populateProductDropdown();
        });

        // Price tag generation
        document.getElementById('generatePriceTagsBtn').addEventListener('click', function() {
            const productId = document.getElementById('priceTagProduct').value;
            const quantity = parseInt(document.getElementById('priceTagQuantity').value);
            const tagSize = document.getElementById('tagSize').value;
            
            if (!productId) {
                showError('Please select a product');
                return;
            }
            
            if (isNaN(quantity) || quantity < 1 || quantity > 50) {
                showError('Please enter a valid quantity between 1 and 50');
                return;
            }
            
            generatePriceTags(productId, quantity, tagSize);
        });

        function generatePriceTags(productId, quantity, tagSize) {
            const product = db.getProductById(productId);
            if (!product) {
                showError('Product not found');
                return;
            }
            
            const container = document.getElementById('priceTagsContainer');
            const printBtn = document.getElementById('printAllTagsBtn');
            
            let html = '';
            for (let i = 0; i < quantity; i++) {
                html += `
                    <div class="price-tag">
                        <div class="product-name">${product.productName}</div>
                        <div class="mrp">MRP: â‚¹${product.productPrice}</div>
                        <div class="expiry">Exp: ${formatDate(product.expiryDate)}</div>
                        <div class="barcode-container">
                            <svg class="barcode"
                                jsbarcode-format="CODE128"
                                jsbarcode-value="${product.barcode}"
                                jsbarcode-textmargin="0"
                                jsbarcode-fontoptions="bold">
                            </svg>
                        </div>
                        <div class="product-info">
                            <div>Category: ${product.productCategory}</div>
                            <div>Size: ${product.productSize}</div>
                        </div>
                        <div class="batch-number">Batch: ${product.batchNumber}</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            container.style.display = 'grid';
            printBtn.style.display = 'inline-flex';
            
            // Initialize barcodes
            JsBarcode(".barcode").init();
            
            // Update counter
            db.incrementPriceTagsGenerated();
        }

        function generateSinglePriceTag(productId) {
            showTab('price-tags');
            document.getElementById('priceTagProduct').value = productId;
            document.getElementById('priceTagQuantity').value = 1;
            generatePriceTags(productId, 1, 'medium');
        }

        document.getElementById('printAllTagsBtn').addEventListener('click', function() {
            window.print();
        });

        // Scanner functionality
        function displayProductInfo(product) {
            document.getElementById('scannedProductName').textContent = product.productName;
            document.getElementById('scannedProductCategory').textContent = product.productCategory;
            document.getElementById('scannedProductPrice').textContent = `â‚¹${product.productPrice}`;
            document.getElementById('scannedProductManufacturer').textContent = product.manufacturer;
            document.getElementById('scannedProductBatch').textContent = product.batchNumber;
            document.getElementById('scannedProductExpiry').textContent = formatDate(product.expiryDate);
            document.getElementById('scannedProductStock').textContent = product.currentStock;
            document.getElementById('scannedProductSize').textContent = product.productSize;
            
            document.getElementById('scannedProductInfo').style.display = 'block';
            window.currentScannedProduct = product;
        }
        
        // Dispatch functionality
        function addToDispatch() {
            if (!window.currentScannedProduct) {
                showError('No product scanned');
                return;
            }
            
            const quantity = 1; // Default quantity
            db.addToDispatch(window.currentScannedProduct.id, quantity);
            updateDispatchView();
            showSuccess(`Added ${quantity} ${window.currentScannedProduct.productName} to dispatch`);
        }
        
        function updateDispatchView() {
            const dispatchItems = db.getDispatchItems();
            const container = document.getElementById('dispatchItems');
            
            if (dispatchItems.length === 0) {
                container.innerHTML = '<p>No items added for dispatch</p>';
                return;
            }
            
            let html = '';
            dispatchItems.forEach(item => {
                html += `
                    <div class="dispatch-item">
                        <div>
                            <strong>${item.productName}</strong>
                            <div>Price: â‚¹${item.price}</div>
                        </div>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="updateDispatchQuantity('${item.productId}', -1)">-</button>
                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                                onchange="setDispatchQuantity('${item.productId}', this.value)">
                            <button class="quantity-btn" onclick="updateDispatchQuantity('${item.productId}', 1)">+</button>
                            <button class="btn btn-small" onclick="removeFromDispatch('${item.productId}')" style="margin-left: 10px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function updateDispatchQuantity(productId, change) {
            let dispatchItems = db.getDispatchItems();
            const item = dispatchItems.find(i => i.productId === productId);
            
            if (item) {
                item.quantity = Math.max(1, item.quantity + change);
                localStorage.setItem('dispatchItems', JSON.stringify(dispatchItems));
                updateDispatchView();
            }
        }
        
        function setDispatchQuantity(productId, quantity) {
            let dispatchItems = db.getDispatchItems();
            const item = dispatchItems.find(i => i.productId === productId);
            
            if (item) {
                item.quantity = Math.max(1, parseInt(quantity) || 1);
                localStorage.setItem('dispatchItems', JSON.stringify(dispatchItems));
                updateDispatchView();
            }
        }
        
        function removeFromDispatch(productId) {
            let dispatchItems = db.getDispatchItems();
            dispatchItems = dispatchItems.filter(i => i.productId !== productId);
            localStorage.setItem('dispatchItems', JSON.stringify(dispatchItems));
            updateDispatchView();
        }
        
        function confirmDispatch() {
            const dispatchItems = db.getDispatchItems();
            if (dispatchItems.length === 0) {
                showError('No items to dispatch');
                return;
            }
            
            const totalDispatched = db.confirmDispatch();
            updateDispatchView();
            showSuccess(`Successfully dispatched ${totalDispatched} items`);
            db.updateDashboard();
            db.renderInventory();
        }
        
        function clearDispatch() {
            db.clearDispatch();
            updateDispatchView();
            showSuccess('Dispatch list cleared');
        }
        
        // Scan mode switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const mode = this.getAttribute('data-mode');
                
                // Update active button
                document.querySelectorAll('.mode-btn').forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');
                
                // Show/hide modes
                if (mode === 'scan') {
                    document.getElementById('scanMode').style.display = 'flex';
                    document.getElementById('dispatchMode').style.display = 'none';
                } else {
                    document.getElementById('scanMode').style.display = 'none';
                    document.getElementById('dispatchMode').style.display = 'block';
                    updateDispatchView();
                }
            });
        });
        
        // Product management
        function editProduct(productId) {
            const product = db.getProductById(productId);
            if (!product) return;
            
            const form = document.getElementById('editProductForm');
            form.innerHTML = `
                <div class="form-group">
                    <label for="editProductName">Product Name</label>
                    <input type="text" id="editProductName" value="${product.productName}">
                </div>
                <div class="info-grid">
                    <div class="form-group">
                        <label for="editProductPrice">MRP (â‚¹)</label>
                        <input type="number" id="editProductPrice" min="0" step="0.01" value="${product.productPrice}">
                    </div>
                    <div class="form-group">
                        <label for="editProductCategory">Category</label>
                        <select id="editProductCategory">
                            <option value="Detergent" ${product.productCategory === 'Detergent' ? 'selected' : ''}>Detergent</option>
                            <option value="Toilet Cleaner" ${product.productCategory === 'Toilet Cleaner' ? 'selected' : ''}>Toilet Cleaner</option>
                            <option value="Floor Cleaner" ${product.productCategory === 'Floor Cleaner' ? 'selected' : ''}>Floor Cleaner</option>
                            <option value="Glass Cleaner" ${product.productCategory === 'Glass Cleaner' ? 'selected' : ''}>Glass Cleaner</option>
                            <option value="Disinfectant" ${product.productCategory === 'Disinfectant' ? 'selected' : ''}>Disinfectant</option>
                            <option value="Bleach" ${product.productCategory === 'Bleach' ? 'selected' : ''}>Bleach</option>
                            <option value="Dish Soap" ${product.productCategory === 'Dish Soap' ? 'selected' : ''}>Dish Soap</option>
                            <option value="Multi-purpose Cleaner" ${product.productCategory === 'Multi-purpose Cleaner' ? 'selected' : ''}>Multi-purpose Cleaner</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editManufacturer">Manufacturer</label>
                    <input type="text" id="editManufacturer" value="${product.manufacturer}">
                </div>
                <div class="info-grid">
                    <div class="form-group">
                        <label for="editBatchNumber">Batch Number</label>
                        <input type="text" id="editBatchNumber" value="${product.batchNumber}">
                    </div>
                    <div class="form-group">
                        <label for="editProductSize">Size/Volume</label>
                        <input type="text" id="editProductSize" value="${product.productSize}">
                    </div>
                </div>
                <div class="info-grid">
                    <div class="form-group">
                        <label for="editCurrentStock">Current Stock</label>
                        <input type="number" id="editCurrentStock" min="0" value="${product.currentStock}">
                    </div>
                    <div class="form-group">
                        <label for="editLowStockThreshold">Low Stock Alert</label>
                        <input type="number" id="editLowStockThreshold" min="1" value="${product.lowStockThreshold}">
                    </div>
                </div>
                <input type="hidden" id="editProductId" value="${product.id}">
            `;
            
            document.getElementById('editProductModal').style.display = 'flex';
        }
        
        function showEditProductModal() {
            if (!window.currentScannedProduct) {
                showError('No product scanned');
                return;
            }
            editProduct(window.currentScannedProduct.id);
        }
        
        function closeEditModal() {
            document.getElementById('editProductModal').style.display = 'none';
        }
        
        function updateProduct() {
            const productId = document.getElementById('editProductId').value;
            const productName = document.getElementById('editProductName').value;
            const productPrice = document.getElementById('editProductPrice').value;
            const productCategory = document.getElementById('editProductCategory').value;
            const manufacturer = document.getElementById('editManufacturer').value;
            const batchNumber = document.getElementById('editBatchNumber').value;
            const productSize = document.getElementById('editProductSize').value;
            const currentStock = parseInt(document.getElementById('editCurrentStock').value);
            const lowStockThreshold = parseInt(document.getElementById('editLowStockThreshold').value);
            
            if (!productName || !productPrice || !productCategory || !manufacturer || 
                !batchNumber || !productSize || isNaN(currentStock) || isNaN(lowStockThreshold)) {
                showError('Please fill in all fields');
                return;
            }
            
            const updatedData = {
                productName,
                productPrice: parseFloat(productPrice),
                productCategory,
                manufacturer,
                batchNumber,
                productSize,
                currentStock,
                lowStockThreshold
            };
            
            if (db.updateProduct(productId, updatedData)) {
                showSuccess('Product updated successfully');
                closeEditModal();
                db.updateDashboard();
                db.renderInventory();
                db.populateProductDropdown();
                
                // Update scanned product info if it's the same product
                if (window.currentScannedProduct && window.currentScannedProduct.id === productId) {
                    displayProductInfo(db.getProductById(productId));
                }
            } else {
                showError('Failed to update product');
            }
        }
        
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                if (db.deleteProduct(productId)) {
                    showSuccess('Product deleted successfully');
                    db.updateDashboard();
                    db.renderInventory();
                    db.populateProductDropdown();
                } else {
                    showError('Failed to delete product');
                }
            }
        }
        
        // Database management functions
        function exportData() {
            db.exportData();
        }
        
        function importData() {
            db.importData();
        }
        
        function clearAllData() {
            db.clearAllData();
        }
        
        function addSampleData() {
            db.addSampleData();
        }
        
        // Monthly Backup functions
        function createMonthlyBackup() {
            db.createMonthlyBackup();
        }
        
        function restoreBackup(backupId) {
            db.restoreBackup(backupId);
        }
        
        function downloadBackup(backupId) {
            db.downloadBackup(backupId);
        }
        
        function deleteBackup(backupId) {
            db.deleteBackup(backupId);
        }
        
        function enableAutoBackup() {
            db.enableAutoBackup();
        }
        
        function disableAutoBackup() {
            db.disableAutoBackup();
        }
        
        // Utility functions
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('errorMessage').style.display = 'none';
            }, 5000);
        }
        
        function showSuccess(message) {
            document.getElementById('successText').textContent = message;
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 5000);
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('manufacturingDate').value = today;
            
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            document.getElementById('expiryDate').value = nextYear.toISOString().split('T')[0];
            
            // Set up tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    showTab(this.getAttribute('data-tab'));
                });
            });
            
            // Update database status
            document.getElementById('footerDbStatus').textContent = 'Active';
        });
    </script>
</body>
</html>